# 前后端功能缺失专项修复对照（2025-12-31）

> 基线文档：`docs/前后端功能缺失专项审查_2025-12-30.md`  
> 目标：把“缺 UI / 缺后端 / UI 禁用/未连接 / 功能不完整”等缺口逐项闭环到可运行的真实链路（UI → Server Action → DB），并保留可复验证据。

## 总览结论

- ✅ `actions-ui-audit`：UI 范围未引用的 actions 导出已清零（0）
- ✅ 专项审查（2025-12-30）列出的“严重缺口”均已具备明确 UI 入口与后端实现
- ✅ 全站乐高化能力已从“仅仪表盘”扩展为：
  - `(dashboard)/layout.tsx` 全局 `PageWorkspace`（任何工作页面可拖拽/保存/恢复）
  - 实体详情页 PageWorkspace 按实体记忆（workspaceKey 自动包含 `::entity::UUID`，并支持从旧 key 自动继承/迁移）
  - 案件/项目详情的侧边栏已拆分为可拖拽 `SectionWorkspace` blocks

## 缺口逐项对照（来自 2025-12-30 专项审查）

### 4.1 后端 Actions 存在但 UI 未调用（原“严重”）

- `cases-crud.getCaseTemplates`：已在 `lawclick-next/src/components/cases/CreateCaseWizard.tsx` 作为模板选择数据源接入。
- `ai-actions.deleteConversation`：已在 `lawclick-next/src/components/floating/ai-assistant-content.tsx` 提供删除入口并调用后端。
- `approval-actions.getApprovalById`：已在 `lawclick-next/src/app/(dashboard)/admin/approvals/[id]/page.tsx` 作为审批详情页数据源接入。
- `event-actions.updateEvent` / `event-actions.deleteEvent`：已在 `lawclick-next/src/components/calendar/EventDetailDialog.tsx` 提供“编辑/删除”入口并调用后端。
- `party-actions.getPartyById`：已在 `lawclick-next/src/app/(dashboard)/cases/parties/[id]/page.tsx` 作为当事人详情页数据源接入。
- `collaboration-actions.getUserDetail`：已在 `lawclick-next/src/app/(dashboard)/team/[id]/page.tsx` 作为成员详情页数据源接入。

### 4.2 后端未实现导致功能缺失（原“严重”）

- `customer-actions.deleteCustomer`：已补齐后端软删除（`Contact.deletedAt/deletedById`），并在 `lawclick-next/src/components/crm/CustomerDeleteButton.tsx` 提供 UI 入口；客户详情页 `lawclick-next/src/app/(dashboard)/crm/customers/[id]/page.tsx` 已接入按钮。

### 4.3 UI 存在但功能禁用/未连接

- 案件删除：`lawclick-next/src/components/cases/CaseSettingsTab.tsx` 已启用删除按钮（带确认 token），调用 `cases-crud.deleteCase` 完成软删除闭环。

### 4.4 功能存在但 UI 不完整

- 案件工时列表：已提供“案件工时记录”可拖拽组件 `lawclick-next/src/components/dashboard/widgets/CaseTimeLogsWidgetClient.tsx`（从案件详情页自动识别 caseId），并可跳转 `tab=timelog`。
- 合同关联文档：已在 `lawclick-next/src/components/finance/ContractDetailClient.tsx` 接入 `linkContractDocument`/`unlinkContractDocument` 完成 UI 闭环。

## 额外补齐（来自 2025-12-29 批判性审计第 9/10 章）

- 文档删除：`lawclick-next/src/components/documents/DocumentListClient.tsx` 与 `lawclick-next/src/components/documents/DocumentDetailClient.tsx` 均已提供删除入口并调用 `documents.deleteDocument`。
- 日程详情读取：`lawclick-next/src/components/calendar/CanvasCalendar.tsx` 打开详情弹窗时会调用 `event-actions.getEventById` 拉取完整详情（含权限遮罩与 canEdit）。

