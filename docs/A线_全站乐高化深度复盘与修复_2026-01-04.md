# A线：全站乐高化（DIY/可拖拽/可记忆/可恢复）深度复盘与修复（2026-01-04）

> 本轮目标：回应“看起来能拖拽但不够像乐高、工具条侵入导致不美观、必须手动保存导致不可靠”的批判点，把 DIY 体验提升到**随心拖拽 + 自动记忆 + 可恢复**，并尽量不破坏页面视觉。

---

## 1. 批判性复盘：之前的体验风险点

1. **工具条侵入性过强**  
   - 页面级 `PageWorkspace` 的“布局/添加/保存/重置”在非编辑态也常驻，容易让产品呈现“后台工具感”，不够 Premium。
2. **手动保存依赖造成不可靠**  
   - “拖完必须点保存”属于典型易错点：一旦忘记/误关闭，DIY 体验会被用户判定为“不可信、像半成品”。
3. **Workspace 卡片 chrome 与系统 Card 风格割裂**  
   - `SectionWorkspace/PageWorkspace` 对 `Card` 进行了降级式样式覆盖（`shadow-sm` 等），导致全局视觉不统一。

---

## 2. 本轮落地修复（代码级）

### 2.1 `SectionWorkspace`：自动保存 + 工具条克制化 + 视觉统一

- 自动保存（防丢）：编辑态、存在未保存变更时，使用 debounce 自动保存；保存失败不自旋重试（同一变更只尝试一次），避免频繁请求导致限流或噪音。
- 工具条更克制：`headerVariant="compact"` 时使用图标化工具条（进入编辑/添加/保存/恢复默认），降低对页面美观的破坏。
- 卡片视觉对齐：去掉对 `Card` 的降级覆盖，恢复使用全局玻璃态/阴影 token；非编辑态隐藏拖拽把手（hover 才出现），降低噪音。
- 代码：`lawclick-next/src/components/layout/SectionWorkspace.tsx`

### 2.2 `PageWorkspace`：全站页面级 DIY 更“像产品”

- 非编辑态只保留一个轻量入口（图标按钮），避免常驻“布局工具栏”破坏页面观感。
- 编辑态提供：状态提示（未保存/已保存/自动保存失败）、添加组件菜单、手动保存、重置。
- 页面容器样式仅在编辑态启用（边框/玻璃态/阴影），平时尽量不干扰内容显示。
- Widget 卡片视觉对齐：同 `SectionWorkspace`，去掉降级覆盖并在非编辑态隐藏拖拽把手。
- 代码：`lawclick-next/src/components/layout/PageWorkspace.tsx`

---

## 3. 本轮复跑证据（质量门禁/审计产物）

### 3.1 质量门禁

- `pnpm -C lawclick-next lint` ✅
- `pnpm -C lawclick-next type-check` ✅
- `pnpm -C lawclick-next build` ✅
- `pnpm -C lawclick-next audit:a11y` ✅
- `pnpm -C lawclick-next exec playwright test tests/e2e/deletion-flows.spec.ts --reporter=line` ✅

### 3.2 审计产物索引（2026-01-04）

- 全站 DIY 覆盖：`docs/_artifacts/lego_diy_coverage_audit_all_2026-01-04.md`
- DIY 深度（catalog size 分布/薄弱点）：`docs/_artifacts/lego_diy_depth_audit_2026-01-04.md`
- 固定网格残留扫描：`docs/_artifacts/lego_coverage_audit_2026-01-04.md`
- 固定堆叠残留扫描：`docs/_artifacts/lego_freeform_coverage_audit_2026-01-04.md`
- 浮窗可用性审计：`docs/_artifacts/floating_lego_block_audit_2026-01-04.md`

---

## 4. 下一步（仍建议的挑刺式人工抽样）

> 自动保存与工具条收敛解决了“体验像半成品”的最大风险点；下一轮建议集中抽样验证：

1. 不同页面/不同 SectionWorkspace：编辑→刷新→换设备→恢复默认 的一致性。  
2. 编辑态频繁拖拽/缩放：是否出现“频繁保存/限流提示/卡顿”。  
3. 复杂页面（案件详情多 Tabs、调度中心、工具箱）：DIY 后是否仍保持可读性与信息层级。  

