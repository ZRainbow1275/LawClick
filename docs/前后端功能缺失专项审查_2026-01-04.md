# LawClick 前后端功能缺失专项审查（复核版）

> **审查类型**：批判性复核（对照旧审查结论，验证是否仍存在“占位/断链/前后端不一致”）  
> **审查范围**：`lawclick-next/`（Next.js App Router + Prisma 主线）  
> **审查日期**：2026-01-04  
> **标准**：以“可运行闭环”为准（UI → Actions → DB → 权限/限流/错误语义），拒绝仅 import/仅注释/仅占位的“伪覆盖”。  

---

## 0. 结论（先说结论）

- 对照 `docs/前后端功能缺失专项审查_2025-12-30.md` 列出的 P0/P1/P2 缺口，本轮复核未发现仍处于“后端已实现但 UI 缺入口 / UI 禁用占位 / 后端缺失”的遗留项。
- 本轮同步复跑了更“可证据化”的 Actions↔UI 覆盖审计产物，能直接定位每个 action 的 UI 引用位置，避免“只给结论不给证据”的偷懒风险：
  - `docs/_artifacts/actions_ui_coverage_audit_2026-01-04.md`
  - `docs/_artifacts/actions_ui_invocation_audit_2026-01-04.md`

---

## 1. 对照旧审查（2025-12-30）逐条复核要点

> 说明：旧审查的“缺口分类汇总（4.1/4.2/4.3/4.4）”为本轮复核基线。

### 1.1 旧 4.1：后端 Actions 存在但 UI 未调用（严重）

- `getCaseTemplates`：已在新建案件流程中接入（`CreateCaseWizard`），具备真实调用链路。  
- `deleteConversation`：已在 AI 助手界面提供删除入口并接入后端（`AIAssistantContent`）。  
- `getApprovalById`：已有审批详情页面路由与数据加载（`/admin/approvals/[id]`）。  
- `updateEvent` / `deleteEvent`：已在日程详情对话框提供编辑/删除入口（`EventDetailDialog`）。  
- `getPartyById` / `getUserDetail`：已具备独立详情页与真实数据加载（当事人、成员）。  

### 1.2 旧 4.2：后端未实现导致功能缺失（严重）

- `deleteCustomer`：后端已实现并有 UI 入口（`CustomerDeleteButton`）。  

### 1.3 旧 4.3：UI 存在但功能禁用/未连接

- `deleteCase`：已存在可执行 UI 入口并接入后端；“禁用占位/暂未开放”类风险本轮未再出现。  
  - 复跑证据：`docs/_artifacts/ui_disabled_buttons_audit_2026-01-04.md`（candidates: 0）

### 1.4 旧 4.4：功能存在但 UI 不完整

- `getCaseTimeLogs` / `getCaseTimeSummary`：已存在案件维度的工时列表与汇总入口（案件详情/工时模块）。  
- `linkContractDocument`：已在合同详情中提供关联/取消关联能力（合同详情 UI）。  

---

## 2. 本轮额外一致性增强（防“体验断链”）

> 这部分不属于 2025-12-30 的“缺口清单”，但属于“前后端一致性”的体验层补齐。

- 全站“乐高化/DIY”的关键基础设施（页面级 + 区块级）已补齐“自动保存（防丢）+ 更克制的工具条（防破坏美观）”。  
  - 代码：`lawclick-next/src/components/layout/SectionWorkspace.tsx`、`lawclick-next/src/components/layout/PageWorkspace.tsx`
  - 目标：避免“有能力但体验上像半成品”的错觉，降低用户必须手动保存导致的实际不一致风险。

---

## 3. 本轮复跑证据索引（可复现）

- Actions↔UI 覆盖（含每个 action 的示例调用点）：`docs/_artifacts/actions_ui_coverage_audit_2026-01-04.md`
- Actions↔UI 调用（防仅 import 的伪覆盖）：`docs/_artifacts/actions_ui_invocation_audit_2026-01-04.md`
- UI 禁用/占位按钮扫描：`docs/_artifacts/ui_disabled_buttons_audit_2026-01-04.md`
- API Surface/路由冲突：`docs/_artifacts/api_surface_audit_2026-01-04.md`
- ORM 并行风险（Rust↔Prisma 实体对照）：`docs/_artifacts/orm_entity_sync_audit_2026-01-04.md`
- 权限枚举一致性（TS↔Rust）：`docs/_artifacts/permissions_sync_audit_2026-01-04.md`

---

## 4. 仍建议保留的“挑刺式”人工抽样点（下一轮）

> 自动化审计能防止“明显断链”，但无法 100% 证明“入口可达/交互顺畅/异常语义一致”。建议下一轮按下列点做 UI 走查 + E2E 抽样：

1. 回收站恢复后的列表筛选一致性（恢复成功后是否仍被筛掉）。  
2. 文档版本历史：上传后版本列表即时更新、预览/下载一致性。  
3. 批量操作（批量归档/删除/移动）与撤销/恢复策略一致性。  

