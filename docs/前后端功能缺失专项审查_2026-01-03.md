# LawClick 前后端功能缺失专项审查（复核版）

> **审查类型**：批判性复核（对照旧审计结论，验证是否仍存在“占位/断链/前后端不一致”）  
> **审查范围**：`lawclick-next/`（Next.js App Router + Prisma 主线）  
> **审查日期**：2026-01-03  
> **方法**：以“可运行闭环”为准（UI → Actions → DB → 错误处理/权限/限流），结合静态审计脚本 + 关键链路人工抽样核对。  

---

## 0. 结论（先说结论）

本轮复核以 2025-12-29/2025-12-30 两份审计文档中列出的“缺 UI / 缺后端 / 禁用占位 / 功能不一致”条目为基准进行回归核对，结合本次自动化审计产物，未发现仍处于“完全缺口”的 P0 级前后端断链问题；旧报告中重点条目均已出现明确的 UI 入口与真实 Action 调用路径（并具备权限、限流、错误语义返回）。

同时，本轮审计也确认：全站页面级 DIY（拖拽/记忆/恢复）能力已覆盖到 **Dashboard 与 Auth** 两个全局 wrapper 之下的全部页面路由（见“2. 乐高化/DIY 覆盖复核”）。

> 注意：本文件为“功能缺失/断链”专项复核，不等价于“代码结构治理/依赖升级/大型文件拆分”等工程性治理（这些纳入后续 B 线治理）。

---

## 1. 对照旧审计：关键缺口项回归核对（证据驱动）

### 1.1 对照 `docs/批判性项目审计报告_2025-12-29.md`（九、十）

旧报告在 “9.2/10.1” 中列出的典型缺口，本轮均已出现 UI 调用：

- **文档删除缺 UI**：`deleteDocument` 已被 UI 触发调用（列表与详情均覆盖）
  - 证据：`lawclick-next/src/components/documents/DocumentListClient.tsx`
  - 证据：`lawclick-next/src/components/documents/DocumentDetailClient.tsx`
- **案件删除按钮禁用/缺后端**：`deleteCase` 已有后端实现且 UI 调用存在
  - 证据：`lawclick-next/src/actions/cases-crud.ts`
  - 证据：`lawclick-next/src/components/cases/CaseSettingsTab.tsx`
- **文档版本历史 UI 待完善**：版本历史列表已提供预览/下载入口，并在文档详情中以可拖拽 Block 呈现
  - 证据：`lawclick-next/src/components/documents/DocumentDetailClient.tsx`
- **工时删除缺 UI**：`deleteTimeLog` 已有 UI 调用
  - 证据：`lawclick-next/src/components/timelog/TimeLogClient.tsx`
- **工具模块编辑/删除 UI 缺失**：`updateToolModule`/`deleteToolModule` 已在工具页被调用
  - 证据：`lawclick-next/src/app/(dashboard)/tools/page.tsx`
- **发票状态更新 UI 缺失**、**收款记录查看缺 UI**：在财务中心已调用对应 actions
  - 证据：`lawclick-next/src/components/admin/FinanceCenterClient.tsx`

### 1.2 对照 `docs/前后端功能缺失专项审查_2025-12-30.md`

旧报告中列出的示例缺口（如 `getCaseTemplates`、`deleteConversation`、`getApprovalById`、`updateEvent`、`deleteEvent`、`deleteCustomer`、实体详情页缺失等）在本轮审计中均已出现 UI 调用证据或页面路由：

- `getCaseTemplates`：`lawclick-next/src/components/cases/CreateCaseWizard.tsx`
- `deleteConversation`：`lawclick-next/src/components/floating/AIAssistantContent.tsx`
- `getApprovalById`：`lawclick-next/src/app/(dashboard)/admin/approvals/[id]/page.tsx`
- `updateEvent`/`deleteEvent`：`lawclick-next/src/components/calendar/EventDetailDialog.tsx`
- `deleteCustomer`：`lawclick-next/src/components/crm/CustomerDeleteButton.tsx`
- 当事人详情：`/cases/parties/:id` → `lawclick-next/src/components/cases/PartyDetailClient.tsx`
- 团队成员详情：`/team/:id` → `lawclick-next/src/components/team/UserDetailClient.tsx`

---

## 2. 乐高化 / DIY 覆盖复核（“全站任意页面”）

### 2.1 页面级 DIY（拖拽/记忆/恢复）覆盖

本轮以静态路由扫描 + 组件追踪确认：全站页面（含 Auth）均处于具备 DIY 基础能力的 wrapper 之下（命中 `PageWorkspace/SectionWorkspace/LegoDeck` 任一即视为具备拖拽/记忆/恢复能力）。

- 证据总览：`docs/_artifacts/lego_diy_coverage_audit_all_2026-01-03.md`
- 全局 wrapper 证据：
  - `lawclick-next/src/app/(dashboard)/layout.tsx`（PageWorkspace）
  - `lawclick-next/src/components/auth/AuthWorkspaceShell.tsx`（SectionWorkspace）

### 2.2 “浮窗打开”能力覆盖（含 Auth）

为保证“任何地方像乐高一样可拆装/可恢复”，本轮确认：

- SectionWorkspace 的 blocks 支持“一键浮窗打开”：`docs/_artifacts/floating_lego_block_audit_2026-01-03.md`
- PageWorkspace 的 widgets 支持“一键浮窗打开”（并支持 URL 回跳聚焦）
- Auth 布局已挂载受限浮窗层（避免“开窗不可见”）

---

## 3. 30-300 人规模调度支持（验证口径）

本轮在日历创建流程中确认了“参与人规模边界”与可用时间推荐链路的防御性处理：

- UI 层对推荐参与人做最大数量保护（≤300）
- 后端 actions 已纳入统一限流审计并通过（见 `docs/_artifacts/action_rate_limit_coverage_audit_2026-01-03.md`）

> 说明：该项为“规模边界 + 防滥用/限流”层面的验证，进一步的压测/容量评估建议纳入 DevOps/性能专项。

---

## 4. 本轮自动化审计产物索引（供复核与证据留存）

- `docs/_artifacts/actions_ui_coverage_audit_2026-01-03.md`
- `docs/_artifacts/actions_ui_invocation_audit_2026-01-03.md`
- `docs/_artifacts/business_completeness_audit_2026-01-03.md`
- `docs/_artifacts/lego_diy_coverage_audit_all_2026-01-03.md`
- `docs/_artifacts/lego_diy_depth_audit_2026-01-03.md`
- `docs/_artifacts/floating_lego_block_audit_2026-01-03.md`
- `docs/_artifacts/action_rate_limit_coverage_audit_2026-01-03.md`
- `docs/_artifacts/action_result_shape_audit_2026-01-03.md`
- `docs/_artifacts/code_structure_audit_2026-01-03.md`
- `docs/_artifacts/deps_health_audit_2026-01-03.md`

---

## 5. 下一步（转入 B 线：结构治理/可维护性/依赖健康）

本轮“缺失专项”未识别新的前后端断链缺口后，将把治理重心转向：

1. 大文件拆分与模块边界治理（见 `docs/_artifacts/code_structure_audit_2026-01-03.md` 的 large files 列表）
2. `tools/page.tsx` 等高复杂页面的组件化拆分与重复逻辑消除
3. 依赖项健康度：在不破坏生产对齐的前提下，规划 Prisma/Types 等升级窗口与回归策略（见 `docs/_artifacts/deps_health_audit_2026-01-03.md`）

