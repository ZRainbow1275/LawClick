# LawClick 前后端功能缺失专项审查报告

> **审查类型**: 批判性专项审查  
> **审查范围**: 所有 Server Actions 的前端调用覆盖率  
> **审查日期**: 2025-12-30  
> **审查视角**: 挑刺、批判性、完全记录

---

## 一、审查范围与方法

### 1.1 审查范围

共审查 **19 个 Actions 文件**，导出 **120+ 个异步函数**。

| 类型 | 文件数 | 函数总数 |
|------|--------|----------|
| CRUD 模块 | 4 | 53 |
| 业务模块 | 15 | 70+ |

### 1.2 审查方法

1. 提取每个 actions 文件的所有 `export async function`
2. 检查每个函数在 `src/components/` 和 `src/app/` 中的调用情况
3. 分类标记：✅ 有调用 | ⚠️ 仅内部调用 | ❌ 无调用

---

## 二、CRUD 模块详细审查

### 2.1 cases-crud.ts (9 个函数)

| 函数名 | 调用状态 | 调用位置 | 问题说明 |
|--------|----------|----------|----------|
| `createCase` | ✅ | CreateCaseWizard | - |
| `getCaseTemplates` | ❌ | - | **后端有实现，前端未调用** |
| `getClientsForSelect` | ✅ | CreateCaseWizard | - |
| `getLawyersForSelect` | ✅ | CreateCaseWizard | - |
| `updateCase` | ✅ | CaseSettingsTab | - |
| `assignCaseHandler` | ✅ | team-heatmap | - |
| `changeCaseStatus` | ✅ | case-kanban | - |
| `archiveCase` | ✅ | CaseSettingsTab | - |
| `deleteCase` | ⚠️ | CaseSettingsTab (未实际调用) | **UI 有按钮但禁用，标注"暂未开放"** |

**问题汇总**:
- ❌ `getCaseTemplates` - 案件模板选择功能缺 UI
- ⚠️ `deleteCase` - 后端已实现，UI 禁用

---

### 2.2 projects-crud.ts (8 个函数)

| 函数名 | 调用状态 | 调用位置 | 问题说明 |
|--------|----------|----------|----------|
| `createProject` | ✅ | CreateProjectDialog | - |
| `getProjects` | ✅ | ProjectsListClient | - |
| `getProjectsListPage` | ✅ | projects/page | - |
| `getProjectDetails` | ✅ | projects/[id]/page | - |
| `updateProject` | ✅ | ProjectSettingsPanelClient | - |
| `deleteProject` | ✅ | ProjectSettingsPanelClient | - |
| `addProjectMember` | ✅ | ProjectMembersPanel | - |
| `removeProjectMember` | ✅ | ProjectMembersPanel | - |

**问题汇总**: 无问题，全部覆盖 ✅

---

### 2.3 tasks-crud.ts (15 个函数)

| 函数名 | 调用状态 | 调用位置 | 问题说明 |
|--------|----------|----------|----------|
| `createCaseTask` | ✅ | TaskKanban, tasks.ts | - |
| `createProjectTask` | ✅ | ProjectTasksPanelClient | - |
| `updateTask` | ✅ | TaskDetailDialog | - |
| `moveTaskOnKanban` | ✅ | TaskKanban | - |
| `updateTaskStatus` | ✅ | (通过 updateTask) | - |
| `assignTask` | ✅ | team-heatmap | - |
| `deleteTask` | ✅ | TaskDetailDialog | - |
| `reorderTasks` | ✅ | TaskKanban | - |
| `getUserTasks` | ⚠️ | - | **内部使用，无直接 UI 调用** |
| `getAccessibleTaskKanbanStatusCounts` | ✅ | TaskKanban | - |
| `getAccessibleTaskKanbanStatusPage` | ✅ | TaskKanban | - |
| `getAccessibleTaskKanbanItemById` | ✅ | TaskKanban | - |
| `getAccessibleTasksForBoardMeta` | ✅ | TaskKanban | - |
| `getAccessibleTasksForBoard` | ✅ | TaskKanban | - |
| `getAccessibleTasksForListPage` | ✅ | tasks/page | - |

**问题汇总**: 
- ⚠️ `getUserTasks` - 可能是遗留函数

---

### 2.4 timelogs-crud.ts (19 个函数)

| 函数名 | 调用状态 | 调用位置 | 问题说明 |
|--------|----------|----------|----------|
| `startTimer` | ✅ | TimerWidget, TaskKanban | - |
| `stopTimer` | ✅ | timer-content | - |
| `pauseTimer` | ✅ | timer-content | - |
| `resumeTimer` | ✅ | timer-content | - |
| `getActiveTimer` | ✅ | dashboard/page, timer-content | - |
| `addManualTimeLog` | ✅ | timelogs.ts | - |
| `getCaseTimeSummary` | ⚠️ | - | **仅 actions 内部，无直接 UI** |
| `getTodayTimeSummary` | ⚠️ | - | **仅 actions 内部，无直接 UI** |
| `getCaseTimeLogs` | ⚠️ | - | **仅 actions 内部，无直接 UI** |
| `getMyTimeLogsMeta` | ✅ | timesheet-calendar | - |
| `getMyTimeLogs` | ✅ | time/page, timesheet-calendar | - |
| `getMyTimeSummary` | ✅ | dashboard/page | - |
| `updateTimeLog` | ✅ | timer-content | - |
| `deleteTimeLog` | ✅ | TimeLogClient | - |
| `getTimeLogsPendingApproval` | ✅ | TimeApprovalClient | - |
| `approveTimeLog` | ✅ | TimeApprovalClient | - |
| `unapproveTimeLog` | ✅ | TimeApprovalClient | - |
| `markTimeLogBilled` | ✅ | TimeApprovalClient | - |
| `unmarkTimeLogBilled` | ✅ | TimeApprovalClient | - |

**问题汇总**: 
- ⚠️ `getCaseTimeSummary` / `getTodayTimeSummary` / `getCaseTimeLogs` - 可能在案件详情页应有 UI

---

## 三、业务模块详细审查

### 3.1 ai-actions.ts (11 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getAIContextSnapshot` | ✅ | - |
| `getConversations` | ✅ | - |
| `getConversation` | ✅ | - |
| `createConversation` | ✅ | - |
| `createConversationWithContext` | ✅ | - |
| `addMessageToConversation` | ✅ | - |
| `deleteConversation` | ❌ | **AI 对话删除功能缺 UI** |
| `chatWithAIEnhanced` | ✅ | - |
| `analyzeDocument` | ✅ | - |
| `analyzeDocumentById` | ✅ | - |
| `getDocumentAIInvocations` | ✅ | DocumentAIReviewClient |

**问题汇总**:
- ❌ `deleteConversation` - **用户无法删除历史 AI 对话**

---

### 3.2 approval-actions.ts (8 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `createApprovalRequest` | ✅ | CreateApprovalDialog |
| `getMyApprovals` | ✅ | admin/approvals/page |
| `getApprovalById` | ❌ | **审批详情查看缺 UI** |
| `approveRequest` | ✅ | ApprovalsBoardClient |
| `rejectRequest` | ✅ | ApprovalsBoardClient |
| `cancelRequest` | ✅ | CaseBillingTab |
| `getAvailableApprovers` | ✅ | CreateApprovalDialog |
| `getApprovalsByCase` | ✅ | CaseBillingTab |

**问题汇总**:
- ❌ `getApprovalById` - **无审批详情页面**

---

### 3.3 contract-actions.ts (6 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `createContract` | ✅ | CreateContractDialog |
| `getContracts` | ✅ | CaseBillingTab, admin/finance |
| `getContractById` | ⚠️ | 仅 actions 内部 |
| `updateContractStatus` | ✅ | FinanceCenterClient |
| `deleteContract` | ⚠️ | 仅 actions 内部引用 |
| `linkContractDocument` | ⚠️ | 仅 actions 内部引用 |

**问题汇总**:
- ⚠️ `deleteContract` / `linkContractDocument` - **合同管理功能不完整**

---

### 3.4 customer-actions.ts (12 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getCustomers` | ✅ | - |
| `getCustomerById` | ✅ | - |
| `createCustomer` | ✅ | - |
| `updateCustomer` | ✅ | - |
| `updateCustomerStage` | ✅ | - |
| `getTags` | ✅ | - |
| `addTagToCustomer` | ✅ | - |
| `createTag` | ✅ | - |
| `addServiceRecord` | ✅ | - |
| `getServiceRecords` | ✅ | - |
| `getCustomerStats` | ✅ | - |
| `getCustomerDirectory` | ✅ | - |

**问题汇总**:
- ❌ **后端缺 `deleteCustomer`** - **无法删除客户**

---

### 3.5 event-actions.ts (7 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getEventOccurrencesInRange` | ✅ | calendar/page, CanvasCalendar |
| `getEventById` | ⚠️ | 仅 actions 内部 |
| `createEvent` | ✅ | CanvasCalendar, TaskKanban |
| `updateEvent` | ❌ | **日程编辑功能缺 UI** |
| `cancelEvent` | ✅ | EventDetailDialog |
| `deleteEvent` | ❌ | **日程删除功能缺 UI** |
| `getAvailableSlots` | ✅ | CanvasCalendar |

**问题汇总**:
- ❌ `updateEvent` - **无法编辑已创建的日程**
- ❌ `deleteEvent` - **无法永久删除日程（只能取消）**

---

### 3.6 finance-actions.ts (8 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getInvoices` | ✅ | CaseBillingTab, admin/finance |
| `createInvoice` | ✅ | CreateInvoiceDialog |
| `updateInvoiceStatus` | ✅ | FinanceCenterClient |
| `getInvoiceStats` | ✅ | admin/finance |
| `recordPayment` | ✅ | RecordPaymentDialog |
| `getPayments` | ✅ | FinanceCenterClient |
| `getExpenses` | ✅ | CaseBillingTab, admin/finance |
| `createExpense` | ✅ | CreateExpenseDialog |

**问题汇总**: 无问题，全部覆盖 ✅

---

### 3.7 tool-actions.ts (7 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getToolModules` | ✅ | tools/page |
| `createToolModule` | ✅ | tools/page |
| `updateToolModule` | ✅ | tools/page |
| `deleteToolModule` | ✅ | tools/page |
| `triggerModuleWebhook` | ✅ | tools/page |
| `getToolInvocations` | ✅ | tools/page |
| `getToolInvocationDetail` | ✅ | tools/page |

**问题汇总**: 无问题，全部覆盖 ✅

---

### 3.8 party-actions.ts (5 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `getCaseParties` | ✅ | - |
| `addParty` | ✅ | - |
| `updateParty` | ✅ | - |
| `deleteParty` | ✅ | - |
| `getPartyById` | ❌ | **当事人详情查看缺 UI** |

**问题汇总**:
- ❌ `getPartyById` - **无当事人独立详情页**

---

### 3.9 collaboration-actions.ts (9 个函数)

| 函数名 | 调用状态 | 问题说明 |
|--------|----------|----------|
| `updateUserStatus` | ✅ | - |
| `getTeamStatus` | ✅ | dispatch/page |
| `getUserDetail` | ❌ | **用户详情查看缺 UI** |
| `createCollaborationInvite` | ✅ | - |
| `respondToMeetingInviteByEventId` | ✅ | - |
| `respondToInvite` | ✅ | - |
| `getMyInvites` | ✅ | dispatch/page |
| `getUserActivity` | ⚠️ | 可能内部使用 |
| `getTeamActivity` | ⚠️ | 可能内部使用 |

**问题汇总**:
- ❌ `getUserDetail` - **无独立用户详情页**

---

### 3.10 其他模块 (notification, chat, tenant, billing, timeline, search)

| 模块 | 函数数 | 覆盖状态 |
|------|--------|----------|
| notification-actions.ts | 3 | ✅ 全覆盖 |
| chat-actions.ts | 6 | ✅ 全覆盖 |
| tenant-actions.ts | 13 | ✅ 全覆盖（TenantAdminClient）|
| billing-actions.ts | 2 | ✅ 全覆盖 |
| timeline-actions.ts | 1 | ⚠️ 待确认 |
| search-actions.ts | 1 | ✅ 全覆盖 |

---

## 四、问题分类汇总

### 4.1 后端 Actions 存在但 UI 未调用 (严重)

| 模块 | 函数 | 缺失功能 | 影响 |
|------|------|----------|------|
| cases-crud | `getCaseTemplates` | 案件模板选择 | 新建案件无法使用模板 |
| ai-actions | `deleteConversation` | AI 对话删除 | 用户无法清理历史对话 |
| approval-actions | `getApprovalById` | 审批详情 | 无法查看单个审批详情 |
| event-actions | `updateEvent` | 日程编辑 | **创建后无法修改日程** |
| event-actions | `deleteEvent` | 日程删除 | **只能取消，无法永久删除** |
| party-actions | `getPartyById` | 当事人详情 | 无独立详情页 |
| collaboration | `getUserDetail` | 用户详情 | 无团队成员详情页 |

### 4.2 后端未实现导致功能缺失 (严重)

| 模块 | 缺失函数 | 缺失功能 | 影响 |
|------|----------|----------|------|
| customer-actions | `deleteCustomer` | 客户删除 | **CRM 无法删除客户** |

### 4.3 UI 存在但功能禁用/未连接

| 模块 | UI 位置 | 当前状态 | 说明 |
|------|---------|----------|------|
| cases-crud | CaseSettingsTab:245 | 按钮禁用 | 标注"暂未开放" |

### 4.4 功能存在但 UI 不完整

| 模块 | 函数 | 问题 |
|------|------|------|
| timelogs-crud | `getCaseTimeLogs` | 案件工时列表无独立 UI |
| timelogs-crud | `getCaseTimeSummary` | 案件工时汇总无独立 UI |
| contract-actions | `linkContractDocument` | 合同关联文档功能缺 UI |

---

## 五、按优先级划分的修复建议

### P0 - 核心业务功能缺失 (必须修复)

| 问题 | 修复建议 |
|------|----------|
| 日程无法编辑 | 在 EventDetailDialog 中添加编辑功能，调用 `updateEvent` |
| 日程无法删除 | 在 EventDetailDialog 中添加删除按钮，调用 `deleteEvent` |
| CRM 无法删除客户 | 实现 `deleteCustomer` 后端 + UI |

### P1 - 管理功能缺失 (应该修复)

| 问题 | 修复建议 |
|------|----------|
| AI 对话无法删除 | 在 AI 助手界面添加删除对话功能 |
| 审批详情无法查看 | 添加审批详情弹窗/页面 |
| 案件模板选择缺失 | 在 CreateCaseWizard 中添加模板选择步骤 |
| 案件删除功能禁用 | 启用删除按钮，确认 `deleteCase` 后端逻辑 |

### P2 - 次要功能缺失 (可以修复)

| 问题 | 修复建议 |
|------|----------|
| 当事人详情页缺失 | 添加当事人独立详情页 |
| 用户详情页缺失 | 添加团队成员详情查看 |
| 案件工时独立列表缺失 | 在案件详情页添加工时 Tab 或独立页面 |
| 合同文档关联 UI 缺失 | 在合同详情中添加文档关联功能 |

---


## 六、统计总结

| 指标 | 数量 |
|------|------|
| 审查 Actions 文件 | 19 |
| 导出函数总数 | 120+ |
| 完全覆盖函数 | 100+ (83%) |
| 无前端调用函数 | 10+ (8%) |
| 后端缺失函数 | 1 (deleteCustomer) |
| UI 禁用/待开放功能 | 1 (deleteCase) |

---

## 七、审查结论

### 7.1 优点

1. **核心业务流程完整** - 案件/任务/工时/文档的主要 CRUD 操作均有完整的前后端对齐
2. **权限控制完善** - 所有 actions 都有权限校验
3. **模块化良好** - 按业务领域清晰分割

### 7.2 关键问题

1. **日程管理功能不完整** - 创建后无法编辑/删除，严重影响日常使用
2. **删除功能系统性缺失** - 客户删除、AI 对话删除等管理功能缺失
3. **详情查看功能分散** - 部分实体（当事人、用户、审批）缺独立详情页

### 7.3 建议

1. **立即修复 P0 问题** - 日程编辑/删除、客户删除
2. **规划 P1 功能迭代** - 审批详情、AI 对话管理、案件模板
3. **建立前后端一致性检查机制** - 新增 actions 时同步检查 UI 覆盖

---

*审查完成时间: 2025-12-30 06:00 CST*
*审查人: Antigravity AI Audit Agent*

---

## 八、2026-01-01 修复回填（落实情况）

> 说明：本节为后续修复的回填记录，用于回答“是否仍存在前后端不一致/占位功能”的质疑；不改动原审查结论，只追加“当前代码已落实到哪里”的证据索引。

- P0：日程编辑/删除已落地（`EventDetailDialog`），客户删除已落地（`deleteCustomer` + UI）。
- P1：AI 对话删除、审批详情、案件模板、案件删除按钮均已补齐真实 UI 入口并接入 actions。
- P2：当事人详情页、成员详情页、案件工时独立列表、合同文档关联均已补齐；其中合同详情页已进一步“乐高化”为 `SectionWorkspace` blocks（可拖拽/可记忆/可恢复）。

完整回归证据与逐条对照表：`docs/_artifacts/audit_followup_2026-01-01.md`。
