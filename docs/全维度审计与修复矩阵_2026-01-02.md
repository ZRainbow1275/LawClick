# LawClick 全维度审计与修复矩阵（2026-01-02）

> 目标：以“生产一致性 / 稳健性 / 可扩展性 / DIY 乐高化 / 前后端一致性”为最高标准，对 Web 主线（`lawclick-next/`）进行 **可复跑** 的批判性审计，并把发现的问题逐条落地修复直至清零。
>
> 说明：
> - 本文件是“总控矩阵”。每个维度的证据输出写入 `docs/_artifacts/`（尽量机器可复跑）。
> - 审计不是一次性的：每次修复后必须复跑对应审计并更新证据链接与状态。
> - 严禁 Mock：所有链路必须 UI → Action → DB/真实依赖 闭环；所有输入必须 Zod 校验；错误必须可解释且不泄露敏感细节。

## 0) 当前总览（已存在的可复跑门禁）

| 维度 | 当前状态 | 最新证据 |
|---|---|---|
| 全站乐高化（任意页面可拖拽配置、可保存/可重置、跨设备记忆） | ✅ 通过 | `docs/_artifacts/lego_diy_coverage_audit_all_2026-01-02.md` |
| 固定卡片栏/分栏候选扫描（应改造为可拖拽区块） | ✅ 候选为 0 | `docs/_artifacts/lego_coverage_audit_2026-01-02.md` / `docs/_artifacts/lego_freeform_coverage_audit_2026-01-02.md` |
| Actions ↔ UI 覆盖（真实调用，而非仅 import/类型引用） | ✅ 通过 | `docs/_artifacts/actions_ui_invocation_audit_2026-01-02.md` |
| Actions 返回形状一致性（判别联合：`success`） | ✅ 通过 | `docs/_artifacts/action_result_shape_audit_2026-01-02.md` |
| Actions 限流覆盖（Server Actions 全量） | ✅ 通过 | `docs/_artifacts/action_rate_limit_coverage_audit_2026-01-02.md` |
| UI 禁用/占位按钮审计 | ✅ 候选为 0 | `docs/_artifacts/ui_disabled_buttons_audit_2026-01-02.md` |
| 路由断链/引用漂移 | ✅ 通过 | 复跑：`pnpm -C lawclick-next audit:routes` |
| 租户隔离（tenant-scope） | ✅ 通过 | 复跑：`pnpm -C lawclick-next audit:tenant-scope` |
| 权限一致性（permission-sync） | ✅ 通过 | 复跑：`pnpm -C lawclick-next audit:permissions-sync` |
| API Surface 重叠（Next 主线 vs Rust 原型） | ✅ 冲突为 0 | `docs/_artifacts/api_surface_audit_2026-01-02.md` |
| ORM Entity 同步（Prisma 主线 vs Rust 原型） | ✅ 通过 | `docs/_artifacts/orm_entity_sync_audit_2026-01-02.md` |

## 1) 本轮新增审计维度（需要补齐“可复跑证据”）

> 下列维度为用户明确要求：需要“审计 → 写入 docs → 逐条修复 → 复跑清零”的闭环。

| 维度 | 计划的审计方式（可复跑） | 证据产物（待生成） | 状态 |
|---|---|---|---|
| 代码结构审查 | 静态扫描：路由/组件/Actions 分层、重复实现、危险耦合点、异常大文件 | `docs/_artifacts/code_structure_audit_*.md` | ⏳ |
| 安全性审计 | 静态扫描：危险 API、XSS/注入风险点、明文敏感信息、开放重定向；运行：依赖漏洞扫描 | `docs/_artifacts/security_audit_*.md` | ⏳ |
| 性能审计 | 静态扫描：Prisma 无界查询/排序、N+1 结构风险、缺索引热路径；运行：关键路由 build 分析 | `docs/_artifacts/performance_audit_*.md` | ⏳ |
| 可访问性审计（A11y） | Playwright + Axe（关键页面 smoke）；静态补充：表单 label/aria/alt | `docs/_artifacts/a11y_audit_*.md` | ⏳ |
| 依赖项健康度 | `pnpm audit` / `pnpm outdated` + “关键依赖版本策略”摘要 | `docs/_artifacts/deps_health_audit_*.md` | ⏳ |
| 数据库设计审计 | Prisma schema：索引/约束/软删一致性；查询热路径与索引匹配 | `docs/_artifacts/db_design_audit_*.md` | ⏳ |
| API 设计一致性 | Server Actions / Route Handlers：错误形状、限流、鉴权、命名规范 | `docs/_artifacts/api_design_audit_*.md` | ⏳ |
| 错误处理与日志 | 静态扫描：`console.*`、泄露 `error.message`、非结构化日志；统一公共错误文案 | `docs/_artifacts/error_logging_audit_*.md` | ⏳ |
| 业务逻辑完整性 | 以“功能缺失专项审查”方法复刻：导出 Actions vs UI 调用点、关键 CRUD 端到端回归 | `docs/_artifacts/business_completeness_audit_*.md` | ⏳ |
| DevOps 就绪度 | docker/迁移/seed/verify-system、环境变量校验、可观测性/告警最小集 | `docs/_artifacts/devops_readiness_audit_*.md` | ⏳ |
| 国际化/本地化 | 静态扫描：用户可见英文文案、日期/数字格式；定义 i18n 策略 | `docs/_artifacts/i18n_l10n_audit_*.md` | ⏳ |
| 代码可维护性 | TODO/FIXME、eslint-disable、重复代码、Action/组件命名约束 | `docs/_artifacts/maintainability_audit_*.md` | ⏳ |

## 2) 前后端一致性：基线对照与“再审查”

> 基线参考：
> - `docs/批判性项目审计报告_2025-12-29.md`（重点：九、十）
> - `docs/前后端功能缺失专项审查_2025-12-30.md`
>
> 本轮要求：在“已有门禁通过”的基础上，重新用“挑刺”视角复跑一次，并把新增发现与修复闭环写入 `docs/_artifacts/business_completeness_audit_*.md`。

## 3) 执行纪律（防偷懒约束）

1. **不接受“看起来有”**：任何“占位 UI / disabled 按钮 / 仅 import 未调用 / 仅返回 success 未落库”的情况一律视为缺陷。
2. **证据优先**：每个修复都必须绑定一个“可复跑”的审计脚本或测试用例；仅靠口头描述不算闭环。
3. **30–300 人规模假设**：所有列表/看板/搜索/拖拽保存必须有：分页/限流/索引/错误恢复。

