# LawClick V9.0 升华记录日志

> **项目目标**: 从"优秀的网页应用"升华为Trello/Mattermost/Lark级别的专业ERP平台
> **参考系统**: LegalMind-Arbitration仲裁系统
> **日期**: 2025-12-10

---

## 升华点1: 浮动生态连接修复 ✅

### 原问题
- AI法律助手按钮点击无响应/无法toggle
- Team Chat组件球点击无响应/无法toggle
- 浮动窗口自动堆叠打开

### 解决方案

| 文件 | 修改内容 |
|------|----------|
| `app-header.tsx` | 添加完整toggle逻辑，统一窗口ID为`ai-paralegal`和`team-chat` |
| `float-store.ts` | 不同窗口类型设置不同初始位置（AI右上、Chat右中、Timer右下） |
| `floating-layer.tsx` | 移除自动打开计时器行为 |
| `dispatch/page.tsx` | 移除直接嵌入的RBACVerification组件 |

### 参考来源
- 仲裁系统 `FloatingToolbar.tsx`：固定/浮动模式切换、可拖拽、localStorage持久化

---

## 升华点2: 新建案件ERP流程重构 ✅

### 原问题
- "新建案件"业务逻辑错误，先冲突检查再填信息
- 缺少专业ERP系统应有的详细字段
- 仅4步流程，信息不完整

### 解决方案
重构为5步ERP向导：

```
Step 1: 基本信息
├── 案件名称、案件类型、委托人、对方当事人、案件描述

Step 2: 案件详情 [NEW]
├── 争议金额、管辖/仲裁机构、受理日期、紧急程度

Step 3: 团队配置 [NEW]
├── 主办律师、律师助理、计费模式、小时费率、预估费用

Step 4: 冲突检查 [后置]
├── 扫描对象、冲突检查、跳过选项、冲突确认

Step 5: 确认创建
├── 信息汇总、创建提交
```

### 参考来源
- 仲裁系统 `CaseInfoEditor.tsx`：4个标签页设计（基本信息/详情/法律依据/风险分析）
- 用户提供的ERP参考图

---

## 升华点3: 案件详情页升华 (待实施)

### 原问题
- 案件详情页信息太空
- 缺少辅助法律人工作的内容

### 规划方案
参考仲裁系统`CaseInfoEditor`，实现7个标签页：

| 标签页 | 内容 |
|--------|------|
| 概览 | 案件状态、争议焦点、法律依据 |
| 当事人 | 客户信息、对方当事人、代理人 |
| 文书 | 嵌入DocumentListClient |
| 任务 | 关联任务列表 |
| 时间线 | 事件历史 |
| 财务 | 工时与账单 |
| 备注 | 团队内部备忘 |

---

## 升华点4: 文档中心升华 (待实施)

### 原问题
- 文档缺少备注和标签
- 无法说明文档内容
- 与案件无法连通

### 规划方案
参考仲裁系统`DocumentManager.tsx`：

- **文档类型**: 证据材料、合同文件、起诉书、答辩书、裁决书、协议书、备忘录
- **状态系统**: 草稿、审核中、已批准、已拒绝、最终版
- **标签功能**: 自定义标签、颜色选择、批量添加
- **备注功能**: 每个文档的内部备注
- **版本控制**: 版本号显示、历史查看
- **收藏功能**: 星标重要文档

---

## 技术实现记录

### 代码变更统计

| 阶段 | 文件数 | 主要变更 |
|------|--------|----------|
| Phase 1 | 4个 | 浮动组件连接、位置分离、自动打开移除 |
| Phase 2 | 1个 | 新建案件向导重构为5步 |

### 验证结果

| 测试项 | 状态 |
|--------|------|
| TypeScript编译 | ✅ 通过 |
| ESLint检查 | ⚠️ 仅any类型警告 |
| npm run build | 待验证 |
| 浮动组件按钮 | ✅ toggle正常 |
| 新建案件向导 | ✅ 5步正常跳转 |

---

## 待完成任务 ✅

- [x] Phase 3: 案件详情页7标签页升华
- [x] Phase 4: 文档中心标签/备注/版本升华
- [x] Phase 5: 智能调度HoverCard修复+forwardRef
- [x] 全面浏览器验证
- [ ] 用户最终确认
